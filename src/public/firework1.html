<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>绚丽烟花动画</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: linear-gradient(to bottom, #000000, #1a1a2e, #16213e);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        touch-action: manipulation;
      }

      canvas {
        display: block;
        box-shadow: 0 0 20px rgba(0, 0, 255, 0.5);
        border-radius: 5px;
      }

      .controls {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(0, 0, 0, 0.5);
        padding: 10px 15px;
        border-radius: 20px;
        color: white;
        font-family: Arial, sans-serif;
        z-index: 100;
      }

      .control-btn {
        background: #4a6fa5;
        border: none;
        color: white;
        padding: 8px 15px;
        margin: 5px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
      }

      .control-btn:hover {
        background: #6a8fc5;
        transform: scale(1.05);
      }

      .control-btn:active {
        transform: scale(0.95);
      }

      .info {
        position: absolute;
        bottom: 20px;
        left: 20px;
        color: white;
        font-family: Arial, sans-serif;
        font-size: 14px;
        z-index: 100;
        background: rgba(0, 0, 0, 0.5);
        padding: 10px 15px;
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <canvas id="fireworksCanvas"></canvas>
    <div class="controls">
      <button class="control-btn" id="addFirework">添加烟花</button>
      <button class="control-btn" id="clearCanvas">清空画面</button>
      <button class="control-btn" id="randomColor">随机颜色</button>
    </div>
    <div class="info">点击屏幕发射烟花 | 移动设备触摸屏幕</div>

    <script>
      // 获取Canvas和绘图上下文
      const canvas = document.getElementById('fireworksCanvas')
      const ctx = canvas.getContext('2d')

      // 设置Canvas尺寸
      function resizeCanvas() {
        canvas.width = window.innerWidth * 0.8
        canvas.height = window.innerHeight * 0.8
      }
      resizeCanvas()
      window.addEventListener('resize', resizeCanvas)

      // 粒子类 - 用于烟花和爆炸效果
      class Particle {
        constructor(x, y, color, isFirework = false) {
          this.x = x
          this.y = y
          this.color = color
          this.isFirework = isFirework
          this.isExploded = false
          this.particles = []
          this.gravity = 0.2
          this.friction = 0.98

          if (isFirework) {
            this.velocity = {
              x: (Math.random() - 0.5) * 2,
              y: Math.random() * -10 - 5,
            }
            this.radius = 3
            this.explosionRadius = Math.random() * 10 + 5
          } else {
            this.velocity = {
              x: (Math.random() - 0.5) * 6,
              y: Math.random() * 2 + 1,
            }
            this.radius = 2
          }
        }

        // 更新粒子状态
        update() {
          if (this.isFirework) {
            // 烟花上升
            this.velocity.y += this.gravity
            this.velocity.x *= this.friction
            this.velocity.y *= this.friction

            // 达到最高点时爆炸
            if (this.velocity.y >= 0) {
              this.explode()
            }
          } else if (this.particles.length === 0) {
            // 爆炸粒子下落
            this.velocity.y += this.gravity
            this.velocity.x *= this.friction
          } else {
            // 爆炸粒子扩散
            for (let i = 0; i < this.particles.length; i++) {
              this.particles[i].update()
            }
          }

          // 更新位置
          this.x += this.velocity.x
          this.y += this.velocity.y
        }

        // 粒子爆炸
        explode() {
          this.isExploded = true
          this.isFirework = false

          // 创建爆炸粒子
          for (let i = 0; i < 100; i++) {
            const angle = (i / 100) * Math.PI * 2
            const magnitude = Math.random() * 2 + 1

            const p = new Particle(this.x, this.y, this.color)
            p.velocity.x = Math.cos(angle) * magnitude
            p.velocity.y = Math.sin(angle) * magnitude
            this.particles.push(p)
          }
        }

        // 绘制粒子
        draw() {
          ctx.beginPath()
          ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2)

          if (this.isFirework) {
            // 烟花尾迹
            ctx.fillStyle = this.color
          } else {
            // 爆炸粒子
            ctx.fillStyle = this.color

            // 粒子透明度随时间变化
            const alpha = 1 - (this.y - canvas.height) / canvas.height
            ctx.globalAlpha = Math.max(0.1, alpha)
          }

          ctx.fill()
          ctx.globalAlpha = 1

          // 绘制爆炸粒子
          if (this.particles.length > 0) {
            for (let i = 0; i < this.particles.length; i++) {
              this.particles[i].draw()
            }
          }
        }
      }

      // 烟花数组
      let fireworks = []
      let useRandomColor = true

      // 生成随机颜色
      function getRandomColor() {
        const hue = Math.random() * 360
        const saturation = '80%'
        const lightness = '60%'
        return `hsl(${hue}, ${saturation}, ${lightness})`
      }

      // 生成主色调烟花
      function getMainColor() {
        const colors = [
          'rgba(255, 50, 50, 0.8)',
          'rgba(50, 255, 50, 0.8)',
          'rgba(50, 50, 255, 0.8)',
          'rgba(255, 255, 50, 0.8)',
          'rgba(255, 50, 255, 0.8)',
          'rgba(50, 255, 255, 0.8)',
        ]
        return colors[Math.floor(Math.random() * colors.length)]
      }

      // 添加烟花
      function addFirework(x = null) {
        const color = useRandomColor ? getRandomColor() : getMainColor()
        const xPos = x !== null ? x : Math.random() * canvas.width
        const firework = new Particle(xPos, canvas.height, color, true)
        fireworks.push(firework)
      }

      // 清空画布
      function clearFireworks() {
        fireworks = []
      }

      // 动画循环
      function animate() {
        // 绘制背景
        ctx.fillStyle = 'rgba(0, 0, 0, 0.1)'
        ctx.fillRect(0, 0, canvas.width, canvas.height)

        // 添加随机烟花
        if (Math.random() < 0.1) {
          addFirework()
        }

        // 更新和绘制所有烟花
        for (let i = fireworks.length - 1; i >= 0; i--) {
          fireworks[i].update()
          fireworks[i].draw()

          // 移除超出画布的烟花
          if (
            fireworks[i].y > canvas.height ||
            fireworks[i].x < 0 ||
            fireworks[i].x > canvas.width
          ) {
            fireworks.splice(i, 1)
          }
        }

        requestAnimationFrame(animate)
      }

      // 事件监听
      canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect()
        const x = e.clientX - rect.left
        const y = e.clientY - rect.top
        addFirework(x)
      })

      canvas.addEventListener('touchstart', (e) => {
        e.preventDefault()
        const touch = e.touches[0]
        const rect = canvas.getBoundingClientRect()
        const x = touch.clientX - rect.left
        addFirework(x)
      })

      document
        .getElementById('addFirework')
        .addEventListener('click', addFirework)
      document
        .getElementById('clearCanvas')
        .addEventListener('click', clearFireworks)
      document.getElementById('randomColor').addEventListener('click', () => {
        useRandomColor = !useRandomColor
        document.getElementById('randomColor').textContent = useRandomColor
          ? '固定颜色'
          : '随机颜色'
      })

      // 启动动画
      animate()
    </script>
  </body>
</html>
